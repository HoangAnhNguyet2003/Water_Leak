<div class="water-meter-page">
  <!-- Search and Filter Section -->
  <div class="filter-section">
    <div class="search-container">
      <input 
        type="text" 
        class="search-input" 
        placeholder="Tìm theo tên đồng hồ"
        [ngModel]="filter().searchTerm"
        (input)="onSearchTermChange($event)"
      >
      <i class="fas fa-search search-icon"></i>
    </div>
    
    <div class="filter-dropdown">
      <select 
        class="status-filter"
        [(ngModel)]="filter().statusFilter"
        (change)="onFilterChange()"
      >
        <option value="">Lọc theo trạng thái</option>
        <option value="Normal">Bình thường</option>
        <option value="On fixing">Đang sửa chữa</option>
        <option value="Anomaly detected">Phát hiện bất thường</option>
      </select>
    </div>
  </div>

  <!-- Table Container with Professional Scroll -->
  <div class="table-container">
    <!-- Fixed Header -->
    <div class="table-header-fixed">
      <table class="water-meter-table header-table">
        <thead>
          <tr>
            <th>Tên trạm</th>
            <th>Địa chỉ</th>
            <th>Trạng thái</th>
            <th>Ngày tham gia</th>
            <th>Hành động</th>
          </tr>
        </thead>
      </table>
    </div>

    <!-- Scrollable Body -->
    <div class="table-body-scrollable">
      <table class="water-meter-table body-table">
        <tbody>
          <ng-container *ngFor="let meter of filteredMeters(); trackBy: trackByMeterId">
            <tr 
              class="table-row"
              [class.selected]="meter.selected"
              [class.expanded]="meter.expanded"
            >
              <td class="name-column">{{ meter.name }}</td>
              <td class="address-column">{{ meter.address }}</td>
              <td class="status-column">
                <span class="status-badge" [ngClass]="getStatusClass(meter.status)">
                  {{ getStatusText(meter.status) }}
                </span>
              </td>
              <td class="date-column">{{ meter.joinDate }}</td>
              <td class="actions-column">
                <button 
                  class="action-btn" 
                  (click)="viewDetails(meter.id)"
                  [class.rotated]="meter.expanded"
                >
                  <i class="fas fa-chevron-down"></i>
                </button>
              </td>
            </tr>
            
            <!-- Detail Row -->
            <tr 
              class="detail-row" 
              *ngIf="meter.expanded"
              [@slideInOut]
            >
              <td colspan="6" class="detail-content">
                <div class="detail-container">
                  <div class="detail-header">
                    <h4 class="detail-title">Thông tin chi tiết</h4>
                  </div>
                  
                  <div class="detail-body">
                    <div class="detail-info-grid">
                      <div class="detail-item">
                        <span class="detail-label">Tên trạm:</span>
                        <span class="detail-value">{{ meter.name }}</span>
                      </div>
                      
                      <div class="detail-item">
                        <span class="detail-label">Địa chỉ:</span>
                        <span class="detail-value">{{ meter.address }}</span>
                      </div>
                      
                      <div class="detail-item">
                        <span class="detail-label">Trạng thái:</span>
                        <span class="detail-value">
                          <span class="status-badge" [ngClass]="getStatusClass(meter.status)">
                            {{ meter.status }}
                          </span>
                        </span>
                      </div>
                      
                      <div class="detail-item">
                        <span class="detail-label">Vượt ngưỡng thủ công:</span>
                        <span class="detail-value anomaly-count">{{ meter.anomalyDetected || 0 }}%</span>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</div>
