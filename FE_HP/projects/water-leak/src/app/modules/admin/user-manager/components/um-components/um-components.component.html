<div class="user-manager-container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="header-left">
      <div class="icon-container">
        <i class="fas fa-users-cog"></i>
      </div>
      <h1 class="page-title">Quản lý người dùng hệ thống</h1>
    </div>

    <div class="header-actions">
      <div class="search-container">
        <input
          type="text"
          class="search-input"
          placeholder="Search username..."
          [ngModel]="searchTerm()"
          (ngModelChange)="onSearchChange($event)">
        <button class="search-btn">
          <i class="fas fa-search"></i>
        </button>
      </div>

      <!-- Filter Dropdown -->
      <div class="filter-container">
        <select
          class="filter-select"
          [ngModel]="selectedRole()"
          (ngModelChange)="onRoleFilterChange($event)">
          <option value="">Tất cả vai trò</option>
          <option value="admin">Administrator</option>
          <option value="company_manager">Tổng công ty</option>
          <option value="branch_manager">Chi nhánh</option>
        </select>
      </div>

      <!-- Clear Filter Button -->
      <button class="clear-filter-btn" (click)="clearFilters()">
        <i class="fas fa-times"></i>
        Xóa bộ lọc
      </button>

      <!-- Add User Button -->
      <button class="add-user-btn" (click)="showAddUserPopup()">
        <i class="fas fa-user-plus"></i>
        Tạo mới một người dùng
      </button>
    </div>
  </div>

  <!-- Table Container -->
  <div class="table-container">
    <!-- Result Counter -->
    <div class="result-counter" *ngIf="allUserData().length > 0">
      <span class="result-text">
        Hiển thị {{ filteredUserData().length }} / {{ filteredUserData().length }} người dùng
      </span>
    </div>

    <div class="table-wrapper">
      <table class="user-table">
        <thead class="table-header">
          <tr>
            <th class="username-col">Username</th>
            <th class="role-col">Vai trò</th>
            <th class="status-col">Trạng thái tài khoản</th>
            <th class="join-date-col">Ngày thêm</th>
            <th class="actions-col">Thao tác</th>
          </tr>
        </thead>
      </table>

      <div class="table-body-wrapper">
        <table class="user-table">
          <tbody>
            <ng-container *ngFor="let user of filteredUserData(); let i = index">
              <tr class="user-row">
                <td class="username-col">
                  <span class="username-text">{{ user['username'] }}</span>
                </td>
                <td class="role-col">
                  <span class="role-badge" [class]="'role-' + user['roleName']">
                    {{ getRoleLabel(user['roleName']) }}
                  </span>
                </td>
                <td class="status-col">
                  <span class="status-badge" [class]="'status-' + (user['isActive'] ? 'active' : 'inactive')">
                    {{ getStatusLabel(user['isActive']) }}
                  </span>
                </td>
                <td class="join-date-col">
                  <span class="join-date">{{ user['lastLogin'] || 'Chưa đăng nhập' }}</span>
                </td>
                <td class="actions-col">
                  <div class="action-dropdown">
                    <button class="dropdown-toggle" (click)="toggleDropdown(i)">
                      <i class="fas fa-chevron-down" [class.rotated]="activeDropdown() === i"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <!-- Dropdown Details Row -->
              <tr *ngIf="activeDropdown() === i" class="dropdown-row">
                <td colspan="5" class="dropdown-cell">
                  <app-dropdown-details
                    #dropdownDetails
                    [user]="user"
                    [isVisible]="true"
                    (changeInfo)="onChangeInformation($event)"
                    (removeUser)="onRemoveUser($event, dropdownDetails)"
                    (close)="closeDropdown()">
                  </app-dropdown-details>
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="filteredUserData().length === 0 && allUserData().length > 0" class="empty-state">
    <div class="empty-icon">
      <i class="fas fa-search"></i>
    </div>
    <h3>Không tìm thấy kết quả</h3>
    <p>Không có người dùng nào phù hợp với bộ lọc hiện tại.</p>
    <button class="clear-filter-btn" (click)="clearFilters()">
      <i class="fas fa-times"></i>
      Xóa bộ lọc
    </button>
  </div>

  <!-- No Data State -->
  <div *ngIf="allUserData().length === 0" class="empty-state">
    <div class="empty-icon">
      <i class="fas fa-users"></i>
    </div>
    <h3>Không có người dùng</h3>
    <p>Chưa có người dùng nào trong hệ thống.</p>
  </div>
</div>

<!-- Add User Form Popup -->
<app-add-user-form
  [isVisible]="showAddUserForm()"
  (cancel)="onAddUserCancel()">
</app-add-user-form>
